<!-- /public/agent.html -->
<!doctype html>
<meta charset="utf-8" />
<title>Agent SDK Test</title>
<body style="font-family: system-ui, sans-serif; margin: 24px;">
  <h1>Agent SDK Test</h1>
  <p>Send a message; server orchestrates calls to <code>/api/dept/all</code> and <code>/api/research/build-kb</code>.</p>

  <label>Tenant ID:
    <input id="tenant" value="tenant_manual_test" style="width: 260px; margin-left: 6px;" />
  </label>

  <br /><br />
  <textarea id="msg" style="width: 100%; height: 140px;">
Create a new lead in the CRM, schedule a 30 minute meeting, and draft a quote. Also research https://example.com and propose a crawl plan.
  </textarea>
  <br />
  <button id="send">Send</button>

  <pre id="out" style="background:#111;color:#0f0;padding:12px;margin-top:16px;overflow:auto"></pre>

  <script>
    const out = document.getElementById('out');
    const sendBtn = document.getElementById('send');

    sendBtn.onclick = async () => {
      out.textContent = 'Sending...';
      try {
        const resp = await fetch('/api/agent/run', {
          method: 'POST',
          headers: {'content-type': 'application/json'},
          body: JSON.stringify({
            message: document.getElementById('msg').value,
            user: 'ui_tester',
            context: {
              tenant_id: document.getElementById('tenant').value,
              capabilities: {}
            }
          })
        });
        const text = await resp.text();
        out.textContent = text || '(empty response)';
      } catch (e) {
        out.textContent = 'Request failed: ' + (e && e.message || e);
      }
    };
  </script>
</body>
